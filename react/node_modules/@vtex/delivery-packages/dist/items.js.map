{"version":3,"file":"items.js","sources":["../src/polyfills.js","../src/items.js"],"sourcesContent":["if (!Array.prototype.findIndex) {\n  // eslint-disable-next-line no-extend-native\n  Array.prototype.findIndex = function(predicate) {\n    if (this === null) {\n      throw new TypeError(\n        'Array.prototype.findIndex called on null or undefined'\n      )\n    }\n    if (typeof predicate !== 'function') {\n      throw new TypeError('predicate must be a function')\n    }\n    var list = Object(this)\n    var length = list.length >>> 0\n    var thisArg = arguments[1]\n    var value\n\n    for (var i = 0; i < length; i++) {\n      value = list[i]\n      if (predicate.call(thisArg, value, i, list)) {\n        return i\n      }\n    }\n    return -1\n  }\n}\n\nif (!Array.prototype.find) {\n  // eslint-disable-next-line no-extend-native\n  Array.prototype.find = function(predicate) {\n    if (this === null) {\n      throw new TypeError('Array.prototype.find called on null or undefined')\n    }\n    if (typeof predicate !== 'function') {\n      throw new TypeError('predicate must be a function')\n    }\n    var list = Object(this)\n    var i = list.findIndex(predicate)\n    return list[i]\n  }\n}\n\nif (!Array.isArray) {\n  Array.isArray = function(arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]'\n  }\n}\n","import './polyfills'\n\n/** PRIVATE **/\n\nexport function getItemIndex(item) {\n  if (!item) {\n    return -1\n  }\n  const index = item.index != null ? item.index : item.itemIndex\n  return index != null ? index : -1\n}\n\n/** PUBLIC **/\n\nexport function getNewItems(items, changes) {\n  if (!items || items.length === 0 || !changes || changes.length === 0) {\n    return items || null\n  }\n\n  const addedSkusFromChanges = changes.reduce(\n    (acc, change) => acc.concat(change.itemsAdded || []),\n    []\n  )\n\n  const removedSkusFromChanges = changes\n    .reduce((acc, change) => acc.concat(change.itemsRemoved || []), [])\n    .map(item => ({\n      ...item,\n      // Change removedItems to negative quantity so we can sum it later\n      quantity: item.quantity * -1,\n    }))\n\n  const itemsChanged = [...addedSkusFromChanges, ...removedSkusFromChanges]\n\n  return items.reduce((acc, item) => {\n    const itemChanges = itemsChanged.filter(\n      changedItem => changedItem.id === item.id\n    )\n\n    const newItem = itemChanges.reduce(\n      (newItem, changedItem) => ({\n        ...newItem,\n        quantity: newItem.quantity + changedItem.quantity,\n      }),\n      item\n    )\n\n    if (newItem.quantity <= 0) return acc\n\n    return acc.concat(newItem)\n  }, [])\n}\n\n/* params: { items, packages } */\nexport function getDeliveredItems(params) {\n  if (!params || !params.items) {\n    return null\n  }\n\n  const { items, packages } = params\n\n  const deliveredItems = items.reduce(\n    (groups, item) => {\n      const packagesWithItem =\n        packages &&\n        packages.filter(pack =>\n          pack.items.some(packageItem => packageItem.itemIndex === item.index)\n        )\n\n      if (packagesWithItem.length === 0) {\n        groups.toBeDelivered = groups.toBeDelivered.concat({\n          item,\n        })\n\n        return groups\n      }\n\n      const quantityInPackages = packagesWithItem.reduce((total, pack) => {\n        const packageItem = pack.items.find(\n          packageItem => packageItem.itemIndex === item.index\n        )\n\n        return total + packageItem.quantity\n      }, 0)\n\n      const packageDeliveredAllItems = quantityInPackages === item.quantity\n      const quantityLeftToDeliver = item.quantity - quantityInPackages\n\n      if (packageDeliveredAllItems === false && quantityLeftToDeliver > 0) {\n        groups.toBeDelivered = groups.toBeDelivered.concat({\n          item: { ...item, quantity: quantityLeftToDeliver },\n        })\n      }\n      const delivered = packagesWithItem.map(pack => {\n        const packageItem = pack.items.find(\n          packageItem => packageItem.itemIndex === item.index\n        )\n\n        return {\n          package: pack,\n          item: { ...item, quantity: packageItem.quantity },\n        }\n      })\n\n      groups.delivered = groups.delivered.concat(delivered)\n\n      return groups\n    },\n    { delivered: [], toBeDelivered: [] }\n  )\n\n  return deliveredItems\n}\n\nexport function getItemsIndexes(items, len = -1) {\n  if (!items || items.length === 0) {\n    return {\n      indexes: [],\n      otherIndexes: [],\n      indexesMap: {},\n      maxIndex: -1,\n    }\n  }\n\n  const indexesMap = {}\n  const indexes = []\n  const otherIndexes = []\n  let maxIndex = 0\n\n  items.forEach(item => {\n    const itemIndex = getItemIndex(item)\n    maxIndex = Math.max(maxIndex, itemIndex)\n    if (itemIndex !== -1) {\n      indexesMap[itemIndex] = item\n      indexes.push(itemIndex)\n    }\n  })\n\n  len = Math.max(len, maxIndex)\n\n  for (let index = 0; index < len; index++) {\n    if (!indexesMap[index]) {\n      otherIndexes.push(index)\n    }\n  }\n\n  return {\n    indexes,\n    otherIndexes,\n    indexesMap,\n    maxIndex,\n  }\n}\n"],"names":["Array","prototype","findIndex","predicate","TypeError","list","Object","length","thisArg","arguments","value","i","call","find","isArray","arg","toString","getItemIndex","item","index","itemIndex","getNewItems","items","changes","addedSkusFromChanges","reduce","acc","change","concat","itemsAdded","removedSkusFromChanges","itemsRemoved","map","quantity","itemsChanged","itemChanges","filter","changedItem","id","newItem","getDeliveredItems","params","packages","deliveredItems","groups","packagesWithItem","pack","some","packageItem","toBeDelivered","quantityInPackages","total","packageDeliveredAllItems","quantityLeftToDeliver","delivered","getItemsIndexes","len","indexesMap","indexes","otherIndexes","maxIndex","forEach","Math","max","push"],"mappings":"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"}