{"version":3,"file":"checkin.esm.js","sources":["../src/polyfills.js","../src/sla.js","../src/utils.js","../src/checkin.js"],"sourcesContent":["if (!Array.prototype.findIndex) {\n  // eslint-disable-next-line no-extend-native\n  Array.prototype.findIndex = function(predicate) {\n    if (this === null) {\n      throw new TypeError(\n        'Array.prototype.findIndex called on null or undefined'\n      )\n    }\n    if (typeof predicate !== 'function') {\n      throw new TypeError('predicate must be a function')\n    }\n    var list = Object(this)\n    var length = list.length >>> 0\n    var thisArg = arguments[1]\n    var value\n\n    for (var i = 0; i < length; i++) {\n      value = list[i]\n      if (predicate.call(thisArg, value, i, list)) {\n        return i\n      }\n    }\n    return -1\n  }\n}\n\nif (!Array.prototype.find) {\n  // eslint-disable-next-line no-extend-native\n  Array.prototype.find = function(predicate) {\n    if (this === null) {\n      throw new TypeError('Array.prototype.find called on null or undefined')\n    }\n    if (typeof predicate !== 'function') {\n      throw new TypeError('predicate must be a function')\n    }\n    var list = Object(this)\n    var i = list.findIndex(predicate)\n    return list[i]\n  }\n}\n\nif (!Array.isArray) {\n  Array.isArray = function(arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]'\n  }\n}\n","import './polyfills'\nimport { isCurrentChannel, isPickup } from './delivery-channel'\nimport { SLA_TYPES } from './constants'\nimport { getCheckInFlagsOnOrder } from './checkin'\n\n/** PRIVATE **/\n\nexport function getSelectedSlaInSlas(item, selectedSla = null) {\n  selectedSla = selectedSla || (item && item.selectedSla)\n\n  if (!item || !item.slas || item.slas.length === 0 || !selectedSla) {\n    return null\n  }\n\n  return item.slas && item.slas.find(sla => sla.id === selectedSla)\n}\n\nexport function getSelectedSlaIfMatchSlaId(item, slaId) {\n  if (!item || !item.slas || item.slas.length === 0 || !slaId) {\n    return null\n  }\n\n  return (\n    item.slas.find(sla => sla.id === slaId && sla.id === item.selectedSla) ||\n    null\n  )\n}\n\nexport function findSlaWithChannel(item, channel) {\n  if (!item || !item.slas || item.slas.length === 0 || !channel) {\n    return null\n  }\n  return item.slas && item.slas.find(sla => isCurrentChannel(sla, channel))\n}\n\nexport function getSlaAsId(sla) {\n  return sla && sla.id ? sla.id : sla\n}\n\n/** PUBLIC **/\n\nexport function hasSLAs(slasSource) {\n  if (slasSource && slasSource.slas) {\n    return !!(slasSource.slas.length > 0)\n  }\n  return !!(slasSource && slasSource.length > 0)\n}\n\nexport function hasDeliveryWindows(slas) {\n  if (!slas) {\n    return false\n  }\n\n  if (!Array.isArray(slas)) {\n    slas = [slas]\n  }\n\n  return slas.some(\n    sla =>\n      sla &&\n      sla.availableDeliveryWindows &&\n      sla.availableDeliveryWindows.length > 0\n  )\n}\n\n/* params = {logisticsInfo, itemIndex, selectedSla} */\nexport function getSelectedSla(params) {\n  if (!params) {\n    return null\n  }\n\n  const { itemIndex, selectedSla: paramSelectedSla, logisticsInfo } = params\n\n  if (!logisticsInfo || !logisticsInfo[itemIndex]) {\n    return null\n  }\n\n  const item = logisticsInfo[itemIndex]\n\n  const selectedSla = paramSelectedSla || (item && item.selectedSla)\n\n  if (!selectedSla || !item.slas || item.slas.length === 0) {\n    return null\n  }\n\n  return getSelectedSlaInSlas(item, selectedSla)\n}\n\nexport function getSlaObj(slas, slaId) {\n  if (!slas || slas.length === 0 || !slaId) {\n    return null\n  }\n\n  const slaObj = slas.find(sla => sla && sla.id === slaId)\n\n  return slaObj || null\n}\n\nexport function getSlaType(slaObj, order) {\n  if (!slaObj) {\n    return null\n  }\n\n  const orderFlags = getCheckInFlagsOnOrder(order)\n\n  if (\n    order &&\n    order.isCheckedIn &&\n    (slaObj.pickupPointId === order.checkedInPickupPointId ||\n      orderFlags.isCheckInOnMasterDataStore)\n  ) {\n    return SLA_TYPES.TAKE_AWAY\n  }\n\n  if (isPickup(slaObj)) {\n    return SLA_TYPES.PICKUP_IN_STORE\n  }\n\n  return SLA_TYPES.DELIVERY\n}\n\nexport function excludePickupTypeFromSlas(slas) {\n  if (!slas || slas.length === 0) {\n    return []\n  }\n\n  return slas.filter(\n    sla => !sla.pickupStoreInfo || !sla.pickupStoreInfo.isPickupStore\n  )\n}\n\nexport function filterPickupTypeFromSlas(slas) {\n  if (!slas || slas.length === 0) {\n    return []\n  }\n\n  return slas.filter(\n    sla => sla && sla.pickupStoreInfo && sla.pickupStoreInfo.isPickupStore\n  )\n}\n\nexport function getSelectedSlas(logisticsInfo) {\n  if (!logisticsInfo || logisticsInfo.length === 0) {\n    return []\n  }\n\n  return logisticsInfo.map(li => {\n    const selectedSlaObj = getSelectedSla({\n      logisticsInfo,\n      itemIndex: li.itemIndex,\n    })\n\n    return selectedSlaObj\n      ? {\n        itemIndex: li.itemIndex,\n        ...selectedSlaObj,\n      }\n      : null\n  })\n}\n\nexport function getPickupSelectedSlas(logisticsInfo) {\n  const selectedSlas = getSelectedSlas(logisticsInfo)\n  return filterPickupTypeFromSlas(selectedSlas)\n}\n\nexport function changeSelectedSla(logisticsInfoItem, sla) {\n  if (!logisticsInfoItem || !sla) {\n    return logisticsInfoItem\n  }\n  return {\n    ...logisticsInfoItem,\n    selectedSla: sla.id,\n    selectedDeliveryChannel: sla.deliveryChannel,\n  }\n}\n","const objectProto = Object.prototype\n\nfunction isPrototype(value) {\n  const Ctor = value && value.constructor\n  const proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto\n\n  return value === proto\n}\n\nexport const isEmpty = elm => {\n  if (typeof elm === 'number') {\n    return false\n  }\n\n  if (!elm) {\n    return true\n  }\n\n  if (Array.isArray(elm) && elm.length === 0) {\n    return true\n  }\n\n  if (typeof elm === 'object' || isPrototype(elm)) {\n    return !Object.keys(elm).length\n  }\n\n  return false\n}\n\nexport const removeEmpty = arr => {\n  if (isEmpty(arr)) {\n    return []\n  }\n\n  return arr.filter(elm => !isEmpty(elm))\n}\n","import { getSelectedSlas } from './sla'\nimport { removeEmpty } from './utils'\n\nexport function isCheckedIn(order) {\n  return !!(order && order.isCheckedIn)\n}\n\nexport function isPickupCheckedIn(order) {\n  return !!(order && order.checkedInPickupPointId)\n}\n\nexport function getCheckInFlagsOnOrder(order) {\n  if (!order || typeof order.isCheckedIn === 'undefined') {\n    return {}\n  }\n\n  const isCheckInOnPickupPoint = isCheckedIn(order) && isPickupCheckedIn(order)\n  const isCheckInOnMasterDataStore =\n    isCheckedIn(order) && !isPickupCheckedIn(order)\n\n  const logisticsInfoWithCheckInSelected = isCheckInOnPickupPoint\n    ? getLogisticsInfoFilteredByCheckIn(order)\n    : null\n  const isDeliveryOnly =\n    !isCheckedIn(order) ||\n    (isCheckInOnPickupPoint &&\n      !!logisticsInfoWithCheckInSelected &&\n      logisticsInfoWithCheckInSelected.length === 0)\n\n  return {\n    isDeliveryOnly,\n    isCheckInOnMasterDataStore,\n    isCheckInOnPickupPoint,\n  }\n}\n\nexport function filterSlasPerCheckIn(slas, order) {\n  slas = removeEmpty(slas)\n  if (slas.length === 0 || !order) {\n    return []\n  }\n\n  return slas.filter(\n    sla => sla.pickupPointId === order.checkedInPickupPointId\n  )\n}\n\nexport function getLogisticsInfoFilteredByCheckIn(order) {\n  if (\n    !order ||\n    !order.shippingData ||\n    !order.shippingData.logisticsInfo\n  ) {\n    return []\n  }\n\n  const { logisticsInfo } = order.shippingData\n  const slas = getSelectedSlas(logisticsInfo)\n  const checkedInSlas = filterSlasPerCheckIn(slas, order)\n\n  if (checkedInSlas.length === 0) {\n    return []\n  }\n\n  const checkedInSlasMap = {}\n  checkedInSlas.forEach(sla => {\n    checkedInSlasMap[sla.itemIndex] = sla\n  })\n\n  return logisticsInfo.filter(li => !!checkedInSlasMap[li.itemIndex])\n}\n\nexport function getItemsFilteredByCheckIn(order) {\n  if (!order || !order.items) {\n    return []\n  }\n\n  const { items } = order\n\n  const newLogisticsInfo = getLogisticsInfoFilteredByCheckIn(order)\n\n  return newLogisticsInfo.map(li => items[li.itemIndex])\n}\n"],"names":["Array","prototype","findIndex","predicate","TypeError","list","Object","length","thisArg","arguments","value","i","call","find","isArray","arg","toString","getSelectedSlaInSlas","item","selectedSla","slas","sla","id","getSelectedSla","params","itemIndex","paramSelectedSla","logisticsInfo","getSelectedSlas","map","selectedSlaObj","li","objectProto","isPrototype","Ctor","constructor","proto","isEmpty","elm","keys","removeEmpty","arr","filter","isCheckedIn","order","isPickupCheckedIn","checkedInPickupPointId","getCheckInFlagsOnOrder","isCheckInOnPickupPoint","isCheckInOnMasterDataStore","logisticsInfoWithCheckInSelected","getLogisticsInfoFilteredByCheckIn","isDeliveryOnly","filterSlasPerCheckIn","pickupPointId","shippingData","checkedInSlas","checkedInSlasMap","forEach","getItemsFilteredByCheckIn","items","newLogisticsInfo"],"mappings":"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"}