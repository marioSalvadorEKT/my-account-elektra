!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.vtex=e.vtex||{},e.vtex.deliveryPackages=t())}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t=function(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e},r="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var i="object"==typeof r&&r&&r.Object===Object&&r,o="object"==typeof self&&self&&self.Object===Object&&self,a=i||o||Function("return this")(),c=a.Symbol;var u=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},l=Array.isArray,s=Object.prototype,d=s.hasOwnProperty,f=s.toString,p=c?c.toStringTag:void 0;var v=function(e){var t=d.call(e,p),r=e[p];try{e[p]=void 0;var n=!0}catch(e){}var i=f.call(e);return n&&(t?e[p]=r:delete e[p]),i},y=Object.prototype.toString;var h=function(e){return y.call(e)},g="[object Null]",b="[object Undefined]",m=c?c.toStringTag:void 0;var _=function(e){return null==e?void 0===e?b:g:m&&m in Object(e)?v(e):h(e)};var j=function(e){return null!=e&&"object"==typeof e},w="[object Symbol]";var I=function(e){return"symbol"==typeof e||j(e)&&_(e)==w},S=1/0,D=c?c.prototype:void 0,O=D?D.toString:void 0;var A=function e(t){if("string"==typeof t)return t;if(l(t))return u(t,e)+"";if(I(t))return O?O.call(t):"";var r=t+"";return"0"==r&&1/t==-S?"-0":r};var x=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},E=NaN,P=/^\s+|\s+$/g,k=/^[-+]0x[0-9a-f]+$/i,W=/^0b[01]+$/i,C=/^0o[0-7]+$/i,T=parseInt;var U=function(e){if("number"==typeof e)return e;if(I(e))return E;if(x(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=x(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(P,"");var r=W.test(e);return r||C.test(e)?T(e.slice(2),r?2:8):k.test(e)?E:+e},z=1/0,B=1.7976931348623157e308;var M=function(e){return e?(e=U(e))===z||e===-z?(e<0?-1:1)*B:e==e?e:0:0===e?e:0};var N=function(e){var t=M(e),r=t%1;return t==t?r?t-r:t:0};var $=function(e){return null==e?"":A(e)};var q=function(e,r,n){e=$(e),r=A(r);var i=e.length,o=n=void 0===n?i:t(N(n),0,i);return(n-=r.length)>=0&&e.slice(n,o)==r};var F=function(e){return function(t,r,n){for(var i=-1,o=Object(t),a=n(t),c=a.length;c--;){var u=a[e?c:++i];if(!1===r(o[u],u,o))break}return t}}();var R=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},Y="[object Arguments]";var V=function(e){return j(e)&&_(e)==Y},K=Object.prototype,H=K.hasOwnProperty,L=K.propertyIsEnumerable,G=V(function(){return arguments}())?V:function(e){return j(e)&&H.call(e,"callee")&&!L.call(e,"callee")};var J=function(){return!1},Q=n(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r?a.Buffer:void 0,o=(i?i.isBuffer:void 0)||J;e.exports=o}),X=9007199254740991,Z=/^(?:0|[1-9]\d*)$/;var ee=function(e,t){var r=typeof e;return!!(t=null==t?X:t)&&("number"==r||"symbol"!=r&&Z.test(e))&&e>-1&&e%1==0&&e<t},te=9007199254740991;var re=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=te},ne={};ne["[object Float32Array]"]=ne["[object Float64Array]"]=ne["[object Int8Array]"]=ne["[object Int16Array]"]=ne["[object Int32Array]"]=ne["[object Uint8Array]"]=ne["[object Uint8ClampedArray]"]=ne["[object Uint16Array]"]=ne["[object Uint32Array]"]=!0,ne["[object Arguments]"]=ne["[object Array]"]=ne["[object ArrayBuffer]"]=ne["[object Boolean]"]=ne["[object DataView]"]=ne["[object Date]"]=ne["[object Error]"]=ne["[object Function]"]=ne["[object Map]"]=ne["[object Number]"]=ne["[object Object]"]=ne["[object RegExp]"]=ne["[object Set]"]=ne["[object String]"]=ne["[object WeakMap]"]=!1;var ie=function(e){return j(e)&&re(e.length)&&!!ne[_(e)]};var oe=function(e){return function(t){return e(t)}},ae=n(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&i.process,a=function(){try{return o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}),ce=ae&&ae.isTypedArray,ue=ce?oe(ce):ie,le=Object.prototype.hasOwnProperty;var se=function(e,t){var r=l(e),n=!r&&G(e),i=!r&&!n&&Q(e),o=!r&&!n&&!i&&ue(e),a=r||n||i||o,c=a?R(e.length,String):[],u=c.length;for(var s in e)!t&&!le.call(e,s)||a&&("length"==s||i&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||ee(s,u))||c.push(s);return c},de=Object.prototype;var fe=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||de)};var pe=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ve=Object.prototype.hasOwnProperty;var ye=function(e){if(!fe(e))return pe(e);var t=[];for(var r in Object(e))ve.call(e,r)&&"constructor"!=r&&t.push(r);return t},he="[object AsyncFunction]",ge="[object Function]",be="[object GeneratorFunction]",me="[object Proxy]";var _e=function(e){if(!x(e))return!1;var t=_(e);return t==ge||t==be||t==he||t==me};var je=function(e){return null!=e&&re(e.length)&&!_e(e)};var we=function(e){return je(e)?se(e):ye(e)};var Ie=function(){this.__data__=[],this.size=0};var Se=function(e,t){return e===t||e!=e&&t!=t};var De=function(e,t){for(var r=e.length;r--;)if(Se(e[r][0],t))return r;return-1},Oe=Array.prototype.splice;var Ae=function(e){var t=this.__data__,r=De(t,e);return!(r<0||(r==t.length-1?t.pop():Oe.call(t,r,1),--this.size,0))};var xe=function(e){var t=this.__data__,r=De(t,e);return r<0?void 0:t[r][1]};var Ee=function(e){return De(this.__data__,e)>-1};var Pe=function(e,t){var r=this.__data__,n=De(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ke(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ke.prototype.clear=Ie,ke.prototype.delete=Ae,ke.prototype.get=xe,ke.prototype.has=Ee,ke.prototype.set=Pe;var We=ke;var Ce=function(){this.__data__=new We,this.size=0};var Te=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Ue=function(e){return this.__data__.get(e)};var ze,Be=function(e){return this.__data__.has(e)},Me=a["__core-js_shared__"],Ne=(ze=/[^.]+$/.exec(Me&&Me.keys&&Me.keys.IE_PROTO||""))?"Symbol(src)_1."+ze:"";var $e=function(e){return!!Ne&&Ne in e},qe=Function.prototype.toString;var Fe=function(e){if(null!=e){try{return qe.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Re=/^\[object .+?Constructor\]$/,Ye=Function.prototype,Ve=Object.prototype,Ke=Ye.toString,He=Ve.hasOwnProperty,Le=RegExp("^"+Ke.call(He).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ge=function(e){return!(!x(e)||$e(e))&&(_e(e)?Le:Re).test(Fe(e))};var Je=function(e,t){return null==e?void 0:e[t]};var Qe=function(e,t){var r=Je(e,t);return Ge(r)?r:void 0},Xe=Qe(a,"Map"),Ze=Qe(Object,"create");var et=function(){this.__data__=Ze?Ze(null):{},this.size=0};var tt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},rt="__lodash_hash_undefined__",nt=Object.prototype.hasOwnProperty;var it=function(e){var t=this.__data__;if(Ze){var r=t[e];return r===rt?void 0:r}return nt.call(t,e)?t[e]:void 0},ot=Object.prototype.hasOwnProperty;var at=function(e){var t=this.__data__;return Ze?void 0!==t[e]:ot.call(t,e)},ct="__lodash_hash_undefined__";var ut=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ze&&void 0===t?ct:t,this};function lt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}lt.prototype.clear=et,lt.prototype.delete=tt,lt.prototype.get=it,lt.prototype.has=at,lt.prototype.set=ut;var st=lt;var dt=function(){this.size=0,this.__data__={hash:new st,map:new(Xe||We),string:new st}};var ft=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var pt=function(e,t){var r=e.__data__;return ft(t)?r["string"==typeof t?"string":"hash"]:r.map};var vt=function(e){var t=pt(this,e).delete(e);return this.size-=t?1:0,t};var yt=function(e){return pt(this,e).get(e)};var ht=function(e){return pt(this,e).has(e)};var gt=function(e,t){var r=pt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function bt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}bt.prototype.clear=dt,bt.prototype.delete=vt,bt.prototype.get=yt,bt.prototype.has=ht,bt.prototype.set=gt;var mt=bt,_t=200;var jt=function(e,t){var r=this.__data__;if(r instanceof We){var n=r.__data__;if(!Xe||n.length<_t-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new mt(n)}return r.set(e,t),this.size=r.size,this};function wt(e){var t=this.__data__=new We(e);this.size=t.size}wt.prototype.clear=Ce,wt.prototype.delete=Te,wt.prototype.get=Ue,wt.prototype.has=Be,wt.prototype.set=jt;var It="__lodash_hash_undefined__";var St=function(e){return this.__data__.set(e,It),this};var Dt=function(e){return this.__data__.has(e)};function Ot(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new mt;++t<r;)this.add(e[t])}Ot.prototype.add=Ot.prototype.push=St,Ot.prototype.has=Dt;a.Uint8Array;var At=c?c.prototype:void 0;At&&At.valueOf;Object.prototype.propertyIsEnumerable,Object.getOwnPropertySymbols;Object.prototype.hasOwnProperty;var xt=Qe(a,"DataView"),Et=Qe(a,"Promise"),Pt=Qe(a,"Set"),kt=Qe(a,"WeakMap"),Wt=Fe(xt),Ct=Fe(Xe),Tt=Fe(Et),Ut=Fe(Pt),zt=Fe(kt),Bt=_;(xt&&"[object DataView]"!=Bt(new xt(new ArrayBuffer(1)))||Xe&&"[object Map]"!=Bt(new Xe)||Et&&"[object Promise]"!=Bt(Et.resolve())||Pt&&"[object Set]"!=Bt(new Pt)||kt&&"[object WeakMap]"!=Bt(new kt))&&(Bt=function(e){var t=_(e),r="[object Object]"==t?e.constructor:void 0,n=r?Fe(r):"";if(n)switch(n){case Wt:return"[object DataView]";case Ct:return"[object Map]";case Tt:return"[object Promise]";case Ut:return"[object Set]";case zt:return"[object WeakMap]"}return t});Object.prototype.hasOwnProperty;var Mt="Expected a function";function Nt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Mt);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(Nt.Cache||mt),r}Nt.Cache=mt;var $t=Nt,qt=500;var Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rt=/\\(\\)?/g;!function(e){var t=$t(e,function(e){return r.size===qt&&r.clear(),e}),r=t.cache}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ft,function(e,r,n,i){t.push(n?i.replace(Rt,"$1"):r||e)}),t});var Yt="[object Number]";var Vt,Kt=function(e){return"number"==typeof e||j(e)&&_(e)==Yt},Ht=864e5;function Lt(e){var t=new Date;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return Math.round(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return e-t}(e,t)/Ht)}(function(e,t){if(!e||!Kt(t))return e;var r=function(e){var t=new Date(e.getTime());return t.setUTCHours(12,0,0,0),t}(e),n=r.getDay(),i=0;0!==n&&6!==n||(i=0===n?1:2);var o=Math.floor((t-1+(n%6||1))/5);return function(e,t){return new Date(e.getTime()+t*Ht)}(r,t+i+2*o)}(t,e),t)}function Gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Jt={BUSINESS_DAYS:"bd",DAYS:"d",HOURS:"h",MINUTES:"m"},Qt=(Gt(Vt={},Jt.BUSINESS_DAYS,86400),Gt(Vt,Jt.DAYS,86400),Gt(Vt,Jt.HOURS,3600),Gt(Vt,Jt.MINUTES,60),Vt);function Xt(e){if(void 0===e||null===e||""===e)return null;var t=er(e),r=Zt(e);return"bd"===t&&(r=Lt(r)),r*Qt[t]}function Zt(e){var t=er(e),r=e.replace(t,"");return r?parseInt(r,10):0}function er(e){var t="bd";return Object.keys(Jt).forEach(function(r){var n=Jt[r];if(q(e,n)){var i=e.replace(n,"");parseInt(i,10).toString()===i&&(t=n)}}),t}var tr=Xt;Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,r=Object(this),n=r.length>>>0,i=arguments[1],o=0;o<n;o++)if(t=r[o],e.call(i,t,o,r))return o;return-1}),Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");var t=Object(this);return t[t.findIndex(e)]}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var rr={groupBySelectedSlaType:!1,groupByAvailableDeliveryWindows:!1,slaOptions:!1,selectedSla:!0,seller:!0,shippingEstimate:!0,deliveryChannel:!0,useMarketplaceItems:!0},nr="pickup-in-point",ir="delivery",or={TAKE_AWAY:"take-away",DELIVERY:ir,PICKUP_IN_STORE:nr};function ar(e,t){return function(e){if("string"==typeof e)return e;if(!e)return null;return e.deliveryChannel||e.selectedDeliveryChannel||e.id||null}(e)===t}var cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lr=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},sr=Object.prototype;var dr=function(e){return"number"!=typeof e&&(!e||(!(!Array.isArray(e)||0!==e.length)||("object"===(void 0===e?"undefined":cr(e))||(r=(t=e)&&t.constructor,t===("function"==typeof r&&r.prototype||sr)))&&!Object.keys(e).length));var t,r},fr=function(e){return dr(e)?[]:e.filter(function(e){return!dr(e)})};function pr(e){return!(!e||!e.isCheckedIn)}function vr(e){return!(!e||!e.checkedInPickupPointId)}function yr(e){if(!e||void 0===e.isCheckedIn)return{};var t=pr(e)&&vr(e),r=pr(e)&&!vr(e),n=t?function(e){if(!e||!e.shippingData||!e.shippingData.logisticsInfo)return[];var t=e.shippingData.logisticsInfo,r=function(e,t){if(0===(e=fr(e)).length||!t)return[];return e.filter(function(e){return e.pickupPointId===t.checkedInPickupPointId})}(function(e){if(!e||0===e.length)return[];return e.map(function(t){var r=gr({logisticsInfo:e,itemIndex:t.itemIndex});return r?ur({itemIndex:t.itemIndex},r):null})}(t),e);if(0===r.length)return[];var n={};return r.forEach(function(e){n[e.itemIndex]=e}),t.filter(function(e){return!!n[e.itemIndex]})}(e):null;return{isDeliveryOnly:!pr(e)||t&&!!n&&0===n.length,isCheckInOnMasterDataStore:r,isCheckInOnPickupPoint:t}}function hr(e){return!!e&&(Array.isArray(e)||(e=[e]),e.some(function(e){return e&&e.availableDeliveryWindows&&e.availableDeliveryWindows.length>0}))}function gr(e){if(!e)return null;var t=e.itemIndex,r=e.selectedSla,n=e.logisticsInfo;if(!n||!n[t])return null;var i=n[t],o=r||i&&i.selectedSla;return o&&i.slas&&0!==i.slas.length?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||e&&e.selectedSla,e&&e.slas&&0!==e.slas.length&&t?e.slas&&e.slas.find(function(e){return e.id===t}):null}(i,o):null}function br(e,t){return e&&0!==e.length&&t&&e.find(function(e){return e&&e.id===t})||null}function mr(e,t){if(!e)return null;var r=yr(t);return t&&t.isCheckedIn&&(e.pickupPointId===t.checkedInPickupPointId||r.isCheckInOnMasterDataStore)?or.TAKE_AWAY:ar(e,nr)?or.PICKUP_IN_STORE:or.DELIVERY}function _r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e&&e.slas&&0!==e.slas.length&&e.slas.find(function(e){return ar(e,ir)&&hr(e)&&function(e,t){return!t||jr(e.availableDeliveryWindows,t)}(e,t)})||null}function jr(e,t){return!(!e||!t)&&(e.length===t.length&&e.filter(function(e,r){return function(e,t){return!(!e||!t)&&e.startDateUtc===t.startDateUtc&&e.endDateUtc===t.endDateUtc&&e.price===t.price&&e.lisPrice===t.lisPrice&&e.tax===t.tax}(e,t[r])}).length===e.length)}function wr(e,t,r){if(!(e&&e.item&&t&&0!==t.length&&r))return e||null;var n,i,o=e.item.index;return ur({},e,{address:function(e){var t=e.itemIndex,r=e.logisticsInfo,n=e.selectedAddresses,i=r[t].addressId;return n.find(function(e){return e.addressId===i})}({itemIndex:o,logisticsInfo:t,selectedAddresses:r}),pickupFriendlyName:(n={itemIndex:o,logisticsInfo:t},i=gr({itemIndex:n.itemIndex,logisticsInfo:n.logisticsInfo}),i&&i.pickupStoreInfo&&i.pickupStoreInfo.friendlyName?i.pickupStoreInfo.friendlyName:null)},function(e){if(!e||!e.logisticsInfo||0===e.logisticsInfo.length)return null;var t=e.itemIndex,r=e.logisticsInfo,n=gr({itemIndex:t,logisticsInfo:r});return{selectedSla:r[t].selectedSla,selectedSlaObj:n,shippingEstimate:n?n.shippingEstimate:r[t].shippingEstimate?r[t].shippingEstimate:void 0,deliveryWindow:function(e,t){return e?e.deliveryWindow:t.deliveryWindow?t.deliveryWindow:void 0}(n,r[t]),shippingEstimateDate:r[t].shippingEstimateDate?r[t].shippingEstimateDate:n?n.shippingEstimateDate:void 0,deliveryChannel:r[t].selectedDeliveryChannel?r[t].selectedDeliveryChannel:n?n.deliveryChannel:void 0,deliveryIds:r[t].deliveryIds,slas:r[t].slas}}({itemIndex:o,logisticsInfo:t}))}function Ir(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!e.selectedSlaObj)return{listPrice:0,price:0,sellingPrice:0};var r={listPrice:e.selectedSlaObj.listPrice,price:e.selectedSlaObj.price,sellingPrice:e.selectedSlaObj.sellingPrice};return e.deliveryWindow&&t&&(r={listPrice:r.listPrice+e.deliveryWindow.lisPrice,price:r.price+e.deliveryWindow.price,sellingPrice:r.sellingPrice+e.deliveryWindow.price}),r}function Sr(e,t,r,n){return e.reduce(function(e,i){var o=n(e,i);if(o){t.selectedSla&&function(e,t){return t.shippingEstimateDate?e.shippingEstimateDate<t.shippingEstimateDate:tr(e.shippingEstimate)<tr(t.shippingEstimate)}(o,i)&&(o.shippingEstimate=i.shippingEstimate,o.shippingEstimateDate=i.shippingEstimateDate),t.selectedSla||(o.slas=o.slas.concat(i.slas)),o.items=o.items.concat(i.item);var a=Ir(i);return o.listPrice+=a.listPrice,o.price+=a.price,o.sellingPrice+=a.sellingPrice,e}var c=br(i.slas,i.selectedSla),u=mr(c,r),l=c||_r(i),s=ur({},Ir(i,!0),{items:[i.item],package:i.package,slas:i.slas,pickupFriendlyName:t.selectedSla?i.pickupFriendlyName:void 0,seller:t.seller?i.item.seller:void 0,address:t.selectedSla&&(i.address||c&&c.pickupStoreInfo&&c.pickupStoreInfo.address)||void 0,selectedSla:t.selectedSla?i.selectedSla:void 0,selectedSlaObj:c,selectedSlaType:u,deliveryIds:i.deliveryIds,deliveryChannel:t.deliveryChannel?i.deliveryChannel:void 0,hasAvailableDeliveryWindows:t.groupByAvailableDeliveryWindows?hr(i.slas):void 0,availableDeliveryWindows:t.groupByAvailableDeliveryWindows&&l?l.availableDeliveryWindows:void 0,deliveryWindow:t.selectedSla?i.deliveryWindow:void 0,shippingEstimate:t.selectedSla?i.shippingEstimate:void 0,shippingEstimateDate:t.selectedSla?i.shippingEstimateDate:void 0,item:void 0});return e.concat(s)},[])}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.items,n=void 0===r?[]:r,i=e.marketplaceItems,o=void 0===i?[]:i,a=e.packageAttachment,c=void 0===a?{}:a,u=e.shippingData,l=void 0===u?{}:u,s=e.changesAttachment,d=void 0===s?{}:s,f=ur({},rr,t.criteria?t.criteria:{}),p=c&&c.packages?c.packages:[],v=l&&l.logisticsInfo?l.logisticsInfo:[],y=l&&l.selectedAddresses?l.selectedAddresses:[],h=d&&d.changesData?d.changesData:[],g=!1===f.useMarketplaceItems||0===o.length?n.map(function(e,t){return ur({},e,{index:t})}):o.map(function(e){return ur({},e,{index:0})}),b=p.map(function(e,t){return ur({},e,{index:t})}),m=function(e){if(!e||!e.items)return null;var t=e.items,r=e.packages;return t.reduce(function(e,t){var n=r&&r.filter(function(e){return e.items.some(function(e){return e.itemIndex===t.index})});if(0===n.length)return e.toBeDelivered=e.toBeDelivered.concat({item:t}),e;var i=n.reduce(function(e,r){return e+r.items.find(function(e){return e.itemIndex===t.index}).quantity},0),o=i===t.quantity,a=t.quantity-i;!1===o&&a>0&&(e.toBeDelivered=e.toBeDelivered.concat({item:ur({},t,{quantity:a})}));var c=n.map(function(e){var r=e.items.find(function(e){return e.itemIndex===t.index});return{package:e,item:ur({},t,{quantity:r.quantity})}});return e.delivered=e.delivered.concat(c),e},{delivered:[],toBeDelivered:[]})}({items:function(e,t){if(!e||0===e.length||!t||0===t.length)return e||null;var r=t.reduce(function(e,t){return e.concat(t.itemsAdded||[])},[]),n=t.reduce(function(e,t){return e.concat(t.itemsRemoved||[])},[]).map(function(e){return ur({},e,{quantity:-1*e.quantity})}),i=[].concat(lr(r),lr(n));return e.reduce(function(e,t){var r=i.filter(function(e){return e.id===t.id}).reduce(function(e,t){return ur({},e,{quantity:e.quantity+t.quantity})},t);return r.quantity<=0?e:e.concat(r)},[])}(g,h),packages:b}),_=function(e){return wr(e,v,y)};m.delivered=m.delivered.map(_),m.toBeDelivered=m.toBeDelivered.map(_);var j=function(e,t,r){return Sr(e,t,r,function(e,t){return e.find(function(e){return e.package.index===t.package.index})})}(m.delivered,f,e),w=function(e,t,r){return Sr(e,t,r,function(e,n){return e.find(function(e){if(t.groupBySelectedSlaType)return e.selectedSlaType===mr(n,r);if(t.shippingEstimate&&t.selectedSla&&e.shippingEstimate!==n.shippingEstimate)return!1;if(t.slaOptions&&e.slas.reduce(function(e,t){return e+t.id},"")!==n.slas.reduce(function(e,t){return e+t.id},""))return!1;if(t.seller&&e.seller!==n.item.seller)return!1;if(t.selectedSla&&e.selectedSla!==n.selectedSla)return!1;var i=e.deliveryWindow&&n.deliveryWindow,o=i&&e.deliveryWindow.startDateUtc!==n.deliveryWindow.startDateUtc&&e.deliveryWindow.endDateUtc!==n.deliveryWindow.endDateUtc;if(t.selectedSla&&(i&&o||!!e.deliveryWindow!=!!n.deliveryWindow))return!1;if(t.deliveryChannel&&e.deliveryChannel!==n.deliveryChannel)return!1;var a=br(n.slas,n.selectedSla)||_r(n);return!(t.groupByAvailableDeliveryWindows&&hr(n.slas)&&(!e.availableDeliveryWindows||!jr(e.availableDeliveryWindows,a.availableDeliveryWindows)))})})}(m.toBeDelivered,f,e);return j.concat(w)}});
//# sourceMappingURL=index.umd.js.map
